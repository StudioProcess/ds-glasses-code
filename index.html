<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ds-glasses-code</title>
</head>
<body>
  <!-- <script type="module" src="index.js" charset="utf-8"></script> -->
  <style>
    * { font-family: system-ui; }
    input { font-size:20px; }
  </style>
</body>

<h2>Layers</h2>
<div id='layers'>
  <input type='number' min='0' max='99'><br>
  <input type='number' min='0' max='99'><br>
  <input type='number' min='0' max='99'><br>
  <input type='number' min='0' max='99'><br>
  <input type='number' min='0' max='99'><br>
</div>

<h2>Code</h2>
<div id='code'>
  <input type=''> 
</div>

<h2>Info</h2>
<div id='info'>
</div>

<script type="module">
 import * as glasses_id from './index.js';
  
  function info(str) {
    document.getElementById('info').innerText = str;
  }
  
  function encode() {
    let inputs = Array.from( document.querySelectorAll('#layers input') );
    let incomplete = inputs.some(i => isNaN(parseInt(i.value)) );
    if (incomplete) {
      info('layers incomplete');
      return;
    }
    let arr = inputs.map( i => parseInt(i.value) );
    let id = glasses_id.encode(arr);
    if (id === false) {
      info("Encode Error");
    } else {
      document.querySelector('#code input').value = id;
      info("Encode OK");
    }
  }
  
  let inputs = Array.from(document.querySelectorAll('#layers input'));
  let code = document.querySelector('#code input');
  
  function decode() {
    let layers = glasses_id.decode(code.value);
    if (layers === false) {
      info("Decode Error");
    } else {
      for (let [i, input] of inputs.entries()) {
        input.value = layers[i];
      }
      info('Decode OK');
    }
  }
  

  for (let i of inputs) {
    i.addEventListener('change', encode);
  }
  code.addEventListener('change', decode);

  
</script>
</html>
